name: ðŸ› Debug Kubeconfig

on:
  workflow_dispatch:  # Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ðŸ”§ Setup kubectl
      uses: azure/setup-kubectl@v3

    - name: ðŸ” Debug Kubeconfig Step-by-Step
      run: |
        echo "=== STEP 1: Check if secret is accessible ==="
        echo "Secret variable name: KUBE_CONFIG_DATA"
        
        echo "=== STEP 2: Create kubeconfig file ==="
        echo "Command: echo \"\${{ secrets.KUBE_CONFIG_DATA }}\" | base64 -d > kubeconfig.yaml"
        echo "${{ secrets.KUBE_CONFIG_DATA }}" | base64 -d > kubeconfig.yaml
        echo "âœ… Kubeconfig file created"
        
        echo "=== STEP 3: Check file size ==="
        ls -la kubeconfig.yaml
        echo "File size should be > 1000 bytes"
        
        echo "=== STEP 4: Show first lines of kubeconfig ==="
        head -3 kubeconfig.yaml
        echo "..."
        
        echo "=== STEP 5: Set KUBECONFIG and test ==="
        export KUBECONFIG=kubeconfig.yaml
        echo "KUBECONFIG environment variable set"
        
        echo "=== STEP 6: Test cluster connection ==="
        kubectl cluster-info
        
        echo "=== STEP 7: Test nodes ==="
        kubectl get nodes
        
        echo "ðŸŽ‰ ALL TESTS PASSED!"